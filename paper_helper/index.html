<!DOCTYPE html>
<html>

<head>
  <link href="lib/roboto_fonts.css" rel="stylesheet">
  <link href="lib/material_icons.css" rel="stylesheet">
  <link href="lib/vuetify.min.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

  <style>
    .abstract {
      font-size: medium;
    }

    .v-expansion-panel-header {
      padding: 10px 16px;
    }

    .v-card__title {
      padding: 0px;
    }

    .v-card__actions {
      padding: 0px;
    }

    .v-chip {
      margin-right: 4px;
    }
  </style>
</head>

<body>
  <div id="app">
    <v-app>
      <!-- <v-navigation-drawer app> -->
      <!-- </v-navigation-drawer> -->

      <v-app-bar app>
        <v-col cols="12" sm="6" md="3">
          <v-text-field v-model="query" append-icon="search" hide-details></v-text-field>
        </v-col>

        <v-col cols="12" sm="6" md="3">
          <v-text-field label="Tags" v-model="query_tags" append-icon="search" hide-details></v-text-field>
        </v-col>

        <v-spacer></v-spacer>
        <v-dialog v-model="dialog">
          <template v-slot:activator="{on, attrs}">
            <v-btn icon v-bind="attrs" v-on="on">
              <v-icon>add</v-icon>
            </v-btn>
          </template>
          <v-card>
            <v-card-text>
              <v-text-field label="Title" v-model="title" dense autofocus></v-text-field>
              <v-combobox label="Tags" v-model="tags" :items="all_tags" multiple :delimiters="[' ']" dense small-chips>
              </v-combobox>
              <v-text-field label="Priority" v-model="priority" dense></v-text-field>
              <v-textarea label="Abstract" v-model="abstract" rows=11 no-resize dense></v-textarea>
              <v-text-field label="Authors" v-model="authors" dense></v-text-field>
              <v-text-field label="URL" v-model="url" dense></v-text-field>
            </v-card-text>

            <v-divider></v-divider>

            <v-card-actions>
              <v-btn color="primary" text @click="add_paper(true)">
                Save
              </v-btn>
              <v-btn color="error" text @click="add_paper(false)">
                Cancel
              </v-btn>
              <v-spacer></v-spacer>
            </v-card-actions>
          </v-card>
        </v-dialog>

        <v-btn icon @click="download_data">
          <v-icon :color="download_red">save_alt</v-icon>
        </v-btn>
        <v-btn icon @click="load_file">
          <v-icon>arrow_upward</v-icon>
        </v-btn>
      </v-app-bar>

      <v-content>
        <v-container fluid>
          <v-expansion-panels accordion>
            <v-expansion-panel v-for="(pd, idx) of filtered_paper_data" :key="pd.time">
              <v-expansion-panel-header hide-actions>
                <v-card class="mx-auto" flat>
                  <v-card-title>{{pd.title}}</v-card-title>
                  <v-card-actions>
                    <v-tooltip right>
                      <template v-slot:activator="{on}">
                        <v-btn text v-on="on" @click.native.stop="open_link(pd.url)">
                          Open
                        </v-btn>
                      </template>
                      <span>{{pd.url}}</span>
                    </v-tooltip>

                    <v-tooltip top v-if="!paper_temp_data[pd.id].show_slider">
                      <template v-slot:activator="{on}">
                        <v-btn icon v-on="on" @mousedown.native.stop="activate_slider(pd, idx)">
                          <v-icon>swap_vert</v-icon>
                        </v-btn>
                      </template>
                      <span>{{pd.priority}}</span>
                    </v-tooltip>
                    <v-col v-else cols="8" sm="4" md="2">
                      <v-slider v-model="pd.priority" :min="min_priority" :max="max_priority" thumb-label="always"
                        thumb-size="24" hide-details height="5" :ref="'slider' + pd.time"></v-slider>
                    </v-col>

                    <v-btn icon @click.native.stop="delete_pd(idx)">
                      <v-icon>delete</v-icon>
                    </v-btn>

                    <v-btn icon @click.native.stop="edit_pd(idx)">
                      <v-icon>edit</v-icon>
                    </v-btn>

                    <v-chip v-for="tag of pd.tags" :key="pd.time + tag" label outlined>{{tag}}</v-chip>

                    <v-spacer></v-spacer>
                    {{pd.date_string}}
                  </v-card-actions>
                </v-card>
              </v-expansion-panel-header>
              <v-expansion-panel-content>
                <span class="abstract">
                  {{pd.abstract}}
                </span>
              </v-expansion-panel-content>
            </v-expansion-panel>
          </v-expansion-panels>
          <v-snackbar v-model="show_undelete_snackbar">
            Data deleted.
            <v-btn text color="red" @click="undelete_pd">Undo</v-btn>
          </v-snackbar>
        </v-container>
      </v-content>

      <v-footer app>
      </v-footer>
    </v-app>
  </div>

  <script src="lib/vue.js"></script>
  <script src="lib/vuetify.js"></script>
  <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
  <script src="https://unpkg.com/dexie-export-import/dist/dexie-export-import.js"></script>
  <script src="main.js"></script>
</body>

</html>
